{% extends "core/base.jinja" %}
{% from 'forum/macros.jinja' import display_forum %}
{% from 'core/macros.jinja' import user_profile_link %}

{% block content %}
    <p>
    <a href="{{ url('forum:main') }}">Forum</a>
    {% for f in forum.get_parent_list() %}
    > <a href="{{ f.get_absolute_url() }}">{{ f }}</a>
    {% endfor %}
    > <a href="{{ forum.get_absolute_url() }}">{{ forum }}</a>
    </p>
    <h3>{{ forum.name }}</h3>
    <a href="{{ url('forum:new_forum') }}?parent={{ forum.id }}">New forum</a>
    {% for f in forum.children.all() %}
    {{ display_forum(f) }}
    {% endfor %}
    {% for t in topics %}
    <div class="topic">
        <p>
            <a href="{{ url('forum:edit_topic', topic_id=t.id) }}">Edit</a>
        </p>
        <a href="{{ url('forum:view_topic', topic_id=t.id) }}">
        <div style="display: inline-block; width: 80%">
            <h5>{{ t.title }}</h5>
            <p>{{ t.description }}</p>
        </div>
        </a>
        <div style="display: inline-block; width: 19%">
            {% set last_msg = t.messages.order_by('id').last() %}
            <p>Last message by {{ user_profile_link(last_msg.author) }} at {{ last_msg.date|date(DATETIME_FORMAT) }} {{
            last_msg.date|time(DATETIME_FORMAT) }}</p>
        </div>
    </div>
    {% endfor %}
    <a href="{{ url('forum:new_topic', forum_id=forum.id) }}">New topic</a>
{% endblock %}



