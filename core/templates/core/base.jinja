<!DOCTYPE html>
<html lang="fr">
    <head>
        {% block head %}
        <title>{% block title %}{% trans %}Welcome!{% endtrans %}{% endblock %} - Association des Étudiants UTBM</title>
        <link rel="shortcut icon" href="{{ static('core/img/favicon.ico') }}">
        <link rel="stylesheet" href="{{ static('core/base.css') }}">
        <link rel="stylesheet" href="{{ static('core/multiple-select.css') }}">
        <link rel="stylesheet" href="{{ static('core/jquery.datetimepicker.min.css') }}">
        <link rel="stylesheet" href="{{ static('ajax_select/css/ajax_select.css') }}">
        <link rel="stylesheet" href="{{ scss('core/style.scss') }}">
        <link rel="stylesheet" href="{{ static('core/js/ui/jquery-ui.min.css') }}">
        {% if settings.EXTERNAL_RES %}
          <noscript><link rel="stylesheet" href="https://use.fontawesome.com/775817bb35.css"></noscript>
          <script src="https://use.fontawesome.com/c06c9c6980.js"></script>
        {% else %}
          <link rel="stylesheet" href="{{ static('core/font-awesome/css/font-awesome.min.css') }}">
        {% endif %}
        {% endblock %}
    </head>

    <body>

        <!-- BEGIN HEADER -->
        {% block header %}
        {% if not popup %}
        <div id="header_language_chooser">
            {% for language in LANGUAGES %}
            <form action="{{ url('set_language') }}" method="post">{% csrf_token %}
                <input name="next" value="{{ request.path }}" type="hidden" />
                <input name="language" value="{{ language[0] }}" type="hidden" />
                <input type="submit" value="{{ language[0]|upper }}" />
            </form>
            {% endfor %}
        </div>

        <header>
            {% if not user.is_authenticated() %}
            <div id="header_logo" style="background-image: url('{{
                static('core/img/logo.png') }}'); width: 185px; height: 100px;">
                <a href="{{ url('core:index') }}"></a>
            </div>
            <div id="header_connect_links">
                <form method="post" action="{{ url('core:login') }}">
                {% csrf_token %}
                <label for="id_username">{% trans %}Username{% endtrans %}</label>
                    <input id="id_username" maxlength="254" name="username" type="text">
                <label for="id_password">{% trans %}Password{% endtrans %}</label>
                    <input type="password" name="password" id="id_password">
                <input type="submit" value="{% trans %}Login{% endtrans %}">
                </form>
                <a href="{{ url('core:register') }}"><button type="button">{% trans %}Register{% endtrans %}</button></a>
            </div>
            {% else %}
            <div id="header_logo" style="background-image: url('{{
                static('core/img/logo.png') }}'); width: 92px; height: 52px;">
                <a href="{{ url('core:index') }}"></a>
            </div>
            <div id="header_bar">
                <ul id="header_bars_infos">
                {% for bar in Counter.objects.filter(type="BAR").all() %}
                    <li>
                    <a href="{{ url('counter:activity', counter_id=bar.id) }}" style="padding: 0px">
                    {% if bar.is_inactive(): %}
                        <i class="fa fa-question" style="color: #f39c12"></i>
                    {% elif bar.is_open(): %}
                        <i class="fa fa-check" style="color: #2ecc71"></i>
                    {% else %}
                        <i class="fa fa-times" style="color: #eb2f06"></i>
                    {% endif %}
                        {{ bar }}
                    </a>
                    </li>
                {% endfor %}
                </ul>
                <form action="{{ url('core:search') }}" method="GET" id="header_search">
                    <input type="text" placeholder="{% trans %}Search{% endtrans %}" name="query" id="search" />
                    <input type="submit" value="{% trans %}Search{% endtrans %}" style="display: none;" />
                </form>
                <div id="header_user_links">
                    <div>
                      <a href="{{ url('core:user_profile', user_id=user.id) }}">{{ user.get_display_name() }}</a>
                    </div>
                    <div>
                      <a href="#" onclick="display_notif()"><i class="fa fa-bell-o"></i> ({{ user.notifications.filter(viewed=False).count() }})</a>
                      <ul id="header_notif">
                          {% for n in user.notifications.filter(viewed=False).order_by('-date') %}
                          <li>
                              <a href="{{ url("core:notification", notif_id=n.id) }}">
                                  <span class="header_notif_date">
                                      {{ n.date|localtime|date(DATE_FORMAT) }}
                                  </span>
                                  <span class="header_notif_time">
                                      {{ n.date|localtime|time(DATETIME_FORMAT) }}
                                  </span>
                                  <br>
                                  {{ n }}
                              </a>
                          </li>
                          {% endfor %}
                          <li>
                              <strong>
                              <a href="{{ url('core:notification_list') }}">
                                  {% trans %}View more{% endtrans %}
                              </a>
                              <br />
                              <a href="{{ url('core:notification_list') }}?see_all">
                                  {% trans %}Mark all as read{% endtrans %}
                              </a>
                              </strong>
                          </li>
                      </ul>
                    </div>
                    <div>
                      <a href="{{ url('core:user_tools') }}">{% trans %}Tools{% endtrans %}</a>
                    </div>
                    <div>
                      <a href="{{ url('core:logout') }}">{% trans %}Logout{% endtrans %}</a>
                    </div>
                </div>
            </div>
            {% endif %}
        </header>

        <div id="info_boxes">
            {% set sith = get_sith() %}
            {% if sith.alert_msg %}
            <div id="alert_box">
                {{ sith.alert_msg|markdown }}
            </div>
            {% endif %}
            {% if sith.info_msg %}
            <div id="info_box">
                {{ sith.info_msg|markdown }}
            </div>
            {% endif %}
        </div>

        {% else %}{# if not popup #}
        <div id="popupheader">{{ user.get_display_name() }}</div>
        {% endif %}


        {% endblock %}
        <!-- END HEADER -->

        <div id="page">
          {% block nav %}
          {% if not popup %}
          <nav>
              <a href="{{ url('core:index') }}">{% trans %}Main{% endtrans %}</a>
              <div class="dropdown">
                <button class="dropbtn">{% trans %}Assocations & Clubs{% endtrans %} 
                <i class="fa fa-caret-down"></i>
                </button>
                <div class="dropdown-content">
                    <a href="/page/ae/">{% trans %}The AE{% endtrans %}</a>
                    <a href="{{ url('core:page', page_name='clubs') }}">{% trans %}The AE's clubs{% endtrans %}</a>
                    <a href="/page/bdf/">{% trans %}The BDF{% endtrans %}</a>
                    <a href="/page/bds/">{% trans %}The BDS{% endtrans %}</a>
                    <a href="/page/cetu/">{% trans %}The CETU{% endtrans %}</a>
                </div>
              </div> 
              <div class="dropdown">
                <button class="dropbtn">{% trans %}Events{% endtrans %} 
                <i class="fa fa-caret-down"></i>
                </button>
                <div class="dropdown-content">
                    <a href="/page/Index/calendrier_evenements/">{% trans %}Calendar{% endtrans %}</a>
                    <a href="/page/GA">{% trans %}Big event{% endtrans %}</a>
                </div>
              </div> 
              <a href="{{ url('forum:main') }}">{% trans %}Forum{% endtrans %}</a>
              <a href="{{ url('sas:main') }}">{% trans %}Gallery{% endtrans %}</a>
              <a href="{{ url('eboutic:main') }}">{% trans %}Eboutic{% endtrans %}</a>
              <div class="dropdown">
                <button class="dropbtn">{% trans %}Services{% endtrans %} 
                <i class="fa fa-caret-down"></i>
                </button>
                <div class="dropdown-content">
                    <a href="{{ url('matmat:search_clear') }}">{% trans %}Matmatronch{% endtrans %}</a>
                    <a href="/launderette">{% trans %}Launderette{% endtrans %}</a>
                    <a href="{{ url('core:file_list') }}">{% trans %}Files{% endtrans %}</a>
                    <a href="https://ae2.utbm.fr/uvs/">{% trans %}Pedagogy{% endtrans %}</a>
                </div>
              </div> 
              <a href="{{ url('core:page', page_name="partenaires")}}">{% trans %}Sponsors{% endtrans %}</a>
              <div class="dropdown">
                <button class="dropbtn">{% trans %}Help{% endtrans %} 
                <i class="fa fa-caret-down"></i>
                </button>
                <div class="dropdown-content">
                    <a href="/page/FAQ/">{% trans %}FAQ{% endtrans %}</a>
                    <a href="{{ url('core:page', 'contacts') }}">{% trans %}Contacts{% endtrans %}</a>
                    <a href="{{ url('core:page', page_name="Index") }}">{% trans %}Wiki{% endtrans %}</a>
                </div>
              </div> 
          </nav>
          {% endif %}
          {% endblock %}

          <ul id="quick_notif">
              {% for n in quick_notifs %}
              <li>{{ n }}</li>
              {% endfor %}
          </ul>

          <div id="content">
              {% if list_of_tabs %}
              <div class="tool_bar">
                  <div>{{ tabs_title }}</div>
                  <div class="tools">
                      {% for t in list_of_tabs -%}
                      <a href="{{ t.url }}"
                          {%- if current_tab == t.slug %}
                              class="selected_tab"
                          {%- endif -%}
                      >{{ t.name }}</a>
                      {%- endfor %}
                  </div>
              </div>
              {% endif %}

              {% if error %}
              {{ error }}
              {% endif %}
              {% block content %}
              {% endblock %}
          </div>
        </div>

        {% if not popup %}
        <footer>
            {% block footer %}
            <div>
                <a href="{{ url('core:page', 'contacts') }}">{% trans %}Contacts{% endtrans %}</a>
                <a href="{{ url('core:page', 'legals') }}">{% trans %}Legal notices{% endtrans %}</a>
                <a href="https://ae2.utbm.fr/copyright_agent.php">{% trans %}Intellectual property{% endtrans %}</a>
                <a href="{{ url('core:page', 'docs') }}">{% trans %}Help & Documentation{% endtrans %}</a>
                <a href="{{ url('core:page', 'rd') }}">{% trans %}R&D{% endtrans %}</a>
                <a href="https://ae2.utbm.fr/">{% trans %}Former website{% endtrans %}</a>
            </div>
            {% trans %}Site made by good people{% endtrans %}
            {% endblock %}
        </footer>
        {% endif %}
        <!--
            {% block tests %}
            {{ tests }}
            {% endblock %}
        -->
        {% block script %}
        <script src="{{ static('core/js/jquery-3.1.0.min.js') }}"></script>
        <script src="{{ static('core/js/ui/jquery-ui.min.js') }}"></script>
        <script src="{{ static('core/js/ui/i18n/datepicker-fr.js') }}"></script>
        <script src="{{ static('core/js/jquery.datetimepicker.full.min.js') }}"></script>
        <script src="{{ static('core/js/multiple-select.js') }}"></script>
        <script src="{{ static('ajax_select/js/ajax_select.js') }}"></script>
        <script src="{{ url('javascript-catalog') }}"></script>
        <script src="{{ static('core/js/script.js') }}"></script>
        <script>
$('.select_single').multipleSelect({
    single: true,
    {% if not popup %}
    position: 'top',
    {% endif %}
});
$('.select_multiple').multipleSelect({
    filter: true,
    {% if not popup %}
    position: 'top',
    {% endif %}
});
$('.select_date').datepicker({
    changeMonth: true,
    changeYear: true,
    dayNamesShort: $.datepicker.regional[ "{{ request.LANGUAGE_CODE }}"  ].dayNamesShort,
    dayNames: $.datepicker.regional[ "{{ request.LANGUAGE_CODE }}"  ].dayNames,
    monthNamesShort: $.datepicker.regional[ "{{ request.LANGUAGE_CODE }}"  ].monthNamesShort,
    monthNames: $.datepicker.regional[ "{{ request.LANGUAGE_CODE }}"  ].monthNames,
}).datepicker( $.datepicker.regional[ "{{ request.LANGUAGE_CODE }}"] );
$(document).keydown(function (e) {
    if ($(e.target).is('input')) { return }
    if ($(e.target).is('textarea')) { return }
    if ($(e.target).is('select')) { return }
    if (e.keyCode == 83) {
        $("#search").focus();
        return false;
    }
});
jQuery.datetimepicker.setLocale('{{ request.LANGUAGE_CODE|lower }}');
$('.select_datetime').datetimepicker({
        format: 'Y-m-d H:i:s',
        });

function add_syntax(e, choice) {
    ta = $(e).parent().children('textarea')[0];
    ta.focus();
    var start = ta.selectionStart;
    var end = ta.selectionEnd;
    var before = ta.value.substring(0, start);
    var after = ta.value.substring(end);
    var between = ta.value.substring(start, end);
    switch (choice) {
        case "bold":
            ta.value = before + "**" + between + "**" + after;
            ta.selectionEnd = end + 2;
            break;
        case "italic":
            ta.value = before + "*" + between + "*" + after;
            ta.selectionEnd = end + 1;
            break;
        case "underline":
            ta.value = before + "__" + between + "__" + after;
            ta.selectionEnd = end + 2;
            break;
        case "strike":
            ta.value = before + "~~" + between + "~~" + after;
            ta.selectionEnd = end + 2;
            break;
        case "sub":
            ta.value = before + "<sub>" + between + "</sub>" + after;
            ta.selectionEnd = end + 5;
            break;
        case "sup":
            ta.value = before + "<sup>" + between + "</sup>" + after;
            ta.selectionEnd = end + 5;
            break;
        case "link":
            if (between === "") {
                between = "https://";
            }
            name = "{% trans %}name{% endtrans %}";
            ta.value = before + "[" + name + "](" + between + ")" + after;
            ta.selectionStart = start + 1;
            ta.selectionEnd = start + 1 + name.length;
            break;
        case "image":
            if (between === "") {
                between = "{% trans %}https://path/to/image.gif{% endtrans %}";
            }
            alt = "{% trans %}alternative text{% endtrans %}";
            ta.value = before + "![" + alt + "](" + between + "?42% \"{% trans %}Title{% endtrans %}\")" + after;
            ta.selectionStart = start + 2;
            ta.selectionEnd = start + 2 + alt.length;
            break;
    }
}

$(document).ready(function() {
    editor = $('.markdown_editor');
    editor.prepend('<a onclick="javascript:add_syntax(this, \'image\')">{% trans %}Image{% endtrans %}</a>');
    editor.prepend('<a onclick="javascript:add_syntax(this, \'link\')">{% trans %}Link{% endtrans %}</a>');
    editor.prepend('<a onclick="javascript:add_syntax(this, \'sup\')"><sup>{% trans %}sup{% endtrans %}</sup></a>');
    editor.prepend('<a onclick="javascript:add_syntax(this, \'sub\')"><sub>{% trans %}sub{% endtrans %}</sub></a>');
    editor.prepend('<a onclick="javascript:add_syntax(this, \'strike\')"><del>{% trans %}S{% endtrans %}</del></a>');
    editor.prepend('<a onclick="javascript:add_syntax(this, \'underline\')"><u>{% trans %}U{% endtrans %}</u></a>');
    editor.prepend('<a onclick="javascript:add_syntax(this, \'italic\')"><i>{% trans %}I{% endtrans %}</i></a>');
    editor.prepend('<a onclick="javascript:add_syntax(this, \'bold\')"><b>{% trans %}B{% endtrans %}</b></a>');
});
        </script>
        {% endblock %}
    </body>
</html>
