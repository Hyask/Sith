{% extends "core/base.jinja" %}

{% macro monthly(obj) %}
<table>
    <thead>
        <tr>
            <td>{% trans %}Year{% endtrans %}</td>
            <td>{% trans %}Month{% endtrans %}</td>
            <td>{% trans %}Total{% endtrans %}</td>
        </tr>
    </thead>
    <tbody>
    {% for array in obj %}
        {% for tuple in array %}
            {% if tuple[0] != 0 %}
            {% set link=url('core:user_account_detail', user_id=profile.id, year=tuple[1].year, month=tuple[1].month) %}
            <tr>
                <td><a href="{{ link }}">{{ tuple[1].year }}</a></td>
                <td><a href="{{ link }}">{{ tuple[1]|date("E") }}</a></td>
                <td><a href="{{ link }}">{{ tuple[0] }} €</a></td>
            </tr>
            {% endif %}
        {% endfor %}
    {% endfor %}
    </tbody>
</table>
{% endmacro %}

{% block title %}
{% trans user_name=profile.get_display_name() %}{{ user_name }}'s account{% endtrans %}
{% endblock %}

{% block content %}
{% if customer %}
<h3>{% trans %}User account{% endtrans %}</h3>
<p>{% trans %}Amount: {% endtrans %}{{ customer.amount }} €</p>
{% if customer.refillings.exists() %}
<h4>{% trans %}Refillings{% endtrans %}</h4>
    {{ monthly(refilling_month) }}
{% endif %}
{% if customer.buyings.exists() %}
<h4>{% trans %}Account buyings{% endtrans %}</h4>
    {{ monthly(buyings_month) }}
{% endif %}
{% if customer.user.invoices.exists() %}
<h4>{% trans %}Eboutic invoices{% endtrans %}</h4>
    {{ monthly(invoices_month) }}
{% endif %}
{% else %}
<p>{% trans %}User has no account{% endtrans %}</p>
{% endif %}
{% endblock %}



