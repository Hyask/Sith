{% extends "core/base.jinja" %}

{% block title %}
{% trans %}Eboutic{% endtrans %}
{% endblock %}

{% macro add_product(id, content) %}
<form method="post" action="{{ url('eboutic:main') }}" class="inline" style="display:inline">
    {% csrf_token %}
    <input type="hidden" name="action" value="add_product">
    <button type="submit" name="product_id" value="{{ id }}"> {{ content }} </button>
</form>
{% endmacro %}

{% macro del_product(id, content) %}
<form method="post" action="{{ url('eboutic:main') }}" class="inline" style="display:inline">
    {% csrf_token %}
    <input type="hidden" name="action" value="del_product">
    <button type="submit" name="product_id" value="{{ id }}"> {{ content }} </button>
</form>
{% endmacro %}

{% block content %}
<h3>{% trans %}Eboutic{% endtrans %}</h3>

<div id="basket">
    <p>{% trans %}Basket: {% endtrans %}</p>
    <ul>
        {% for i in basket.items.all()|sort(attribute='id') %}
        <li>{{ del_product(i.product_id, '-') }} {{ i.quantity }}
        {{ add_product(i.product_id, '+') }} {{ i.product_name }}: {{ "%0.2f"|format(i.product_unit_price*i.quantity) }} €</li>
        {% endfor %}
    </ul>
    <p><strong>{% trans %}Total: {% endtrans %}{{ "%0.2f"|format(basket.get_total()) }} €</strong></p>
    <form method="post" action="{{ url('eboutic:command') }}">
        {% csrf_token %}
        <input type="submit" value="{% trans %}Proceed to command{% endtrans %}" />
    </form>
</div>
<div>
    {% for t in categories %}
    {% if eboutic.products.filter(product_type=t).exists() %}
        <h5>{{ t }}</h5>
        {% for p in eboutic.products.filter(product_type=t).all() %}
        {{ add_product(p.id, p.name) }}
        {% endfor %}
    {% endif %}
    {% endfor %}
</div>

{% endblock %}



