{% extends "core/base.jinja" %}
{% from "pedagogy/macros.jinja" import display_star %}

{% block title %}
{% trans %}UV Details{% endtrans %}
{% endblock %}

{% block content %}
	<div id="pedagogy">
		<p id="return_noscript"><a href="{{ url('pedagogy:guide') }}">{% trans %}Back{% endtrans %}</a></p>
		<button id="return_js" onclick='(function(){
			// If comes from the guide page, go back with history
			if (document.referrer.replace(/\?(.+)/gm,"").endsWith(`{{ url("pedagogy:guide") }}`)){
				window.history.back();
				return;
			}
			// Simply goes to the guide page
			window.location.href = `{{ url("pedagogy:guide") }}`;
		})()' hidden>{% trans %}Back{% endtrans %}</button>

		<h1>{{ object.code }} - {{ object.title }}</h1>
		<p style = "word-spacing: 20px;">{{ object.department }} {{ object.credit_type }} {{ object.semester_translated }}</p>

		<br>

		<div class="grid-container">
			<div class="grade">
				<p>{% trans %}global grade{% endtrans %}</p>
				<p>{% trans %}utility{% endtrans %}</p>
				<p>{% trans %}interest{% endtrans %}</p>
				<p>{% trans %}teaching{% endtrans %}</p>
				<p>{% trans %}work load{% endtrans %}</p>
			</div>
			<div class="grade-stars">
				<p>{{ display_star(object.grade_global_average) }}</p>
				<p>{{ display_star(object.grade_utility_average) }}</p>
				<p>{{ display_star(object.grade_interest_average) }}</p>
				<p>{{ display_star(object.grade_teaching_average) }}</p>
				<p>{{ display_star(object.grade_work_load_average) }}</p>
			</div>
			<div class="uv-infos">
				<p><b>{% trans %}Objectives{% endtrans %}</b></p>
				<p>{{ object.objectives|markdown }}</p>
				<p><b>{% trans %}Program{% endtrans %}</b></p>
				<p>{{ object.program|markdown }}</p>
				<p><b>{% trans %}Earned skills{% endtrans %}</b></p>
				<p>{{ object.skills|markdown }}</p>
				<p><b>{% trans %}Key concepts{% endtrans %}</b></p>
				<p>{{ object.key_concepts }}</p>
				<p><b>{% trans %}UV manager: {% endtrans %}</b>{{ object.manager }}</p>
			</div>
		</div>

		{% if object.comments.exists() %}
			<h2>{% trans %}Comments{% endtrans %}</h2>
			{% for comment in object.comments.order_by("-publish_date").all() %}
				<div id="{{ comment.id }}" class="comment">
					<div class="grade_block">
						<div class="dif_grade">
							<p>{% trans %}global grade{% endtrans %}</p>
							<p>{% trans %}utility{% endtrans %}</p>
							<p>{% trans %}interest{% endtrans %}</p>
							<p>{% trans %}teaching{% endtrans %}</p>
							<p>{% trans %}work load{% endtrans %}</p>
						</div>
						<div class="grade">
							<p>{{ display_star(comment.grade_global) }}</p>
							<p>{{ display_star(comment.grade_utility) }}</p>
							<p>{{ display_star(comment.grade_interest) }}</p>
							<p>{{ display_star(comment.grade_teaching) }}</p>
							<p>{{ display_star(comment.grade_work_load) }}</p>
						</div>
					</div>
					<div class="anchor">
						<a href="{{ url('pedagogy:uv_detail', uv_id=uv.id) }}#{{ comment.id }}"><i class="fa fa-paragraph"></i></a>
					</div>
					{{ comment.comment|markdown }}

					{% if comment.is_reported %}
						<p class="status_reported">
							{% trans %}This comment has been reported{% endtrans %}
						</p>
					{% endif %}

					{% if user.is_owner(comment) %}
						<p class="action">
								<a href="{{ url('pedagogy:comment_update', comment_id=comment.id) }}">{% trans %}Edit{% endtrans %}</a>
								<a href="{{ url('pedagogy:comment_delete', comment_id=comment.id) }}">{% trans %}Delete{% endtrans %}</a>
						</p>
					{% endif %}

					<div class="info">
						<p class="report"><a href="{{ url('pedagogy:comment_report', comment_id=comment.id) }}">{% trans %}Report this comment{% endtrans %}</a></p>
						<p class="date_info">{{ comment.publish_date.strftime('%d/%m/%Y') }}</p>
						<p class="author_info">{{ comment.author }}</p>
					</div>

				</div>
			{% endfor %}
		{% endif %}

		<h2>{% trans %}Leave comment{% endtrans %}</h2>
		<form action="{{ url('pedagogy:uv_detail', uv_id=object.id) }}" method="post" enctype="multipart/form-data">
			{% csrf_token %}
			{{ form.as_p() }}
			<p><input type="submit" value="{% trans %}Comment{% endtrans %}" /></p>
		</form>
	</div>

	<script type="text/javascript">
		$("#return_noscript").hide();
		$("#return_js").show();
	</script>
{% endblock %}
