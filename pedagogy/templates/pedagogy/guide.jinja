
{% extends "core/base.jinja" %}

{% block title %}
{% trans %}UV Guide{% endtrans %}
{% endblock %}

{% block content %}
<form id="search_form" action="{{ url('pedagogy:guide') }}" method="get">
	<p>
		<input type="text" name="search">
		<button>{% trans %}Details{% endtrans %}</button>
	</p>
	<p>
		<input type="radio" name="department" value="EDIM">{% trans %}EDIM{% endtrans %}
		<input type="radio" name="department" value="EE">{% trans %}ENERGIE{% endtrans %}
		<input type="radio" name="department" value="IMSI">{% trans %}IMSI{% endtrans %}
		<input type="radio" name="department" value="GI">{% trans %}INFO{% endtrans %}
		<input type="radio" name="department" value="MC">{% trans %}GMC{% endtrans %}
		<input type="radio" name="department" value="HUMA">{% trans %}HUMA{% endtrans %}
		<input type="radio" name="department" value="TC">{% trans %}TC{% endtrans %}
	</p>
	<p>
		<input type="radio" name="credit_type" value="CS">{% trans %}CS{% endtrans %}
		<input type="radio" name="credit_type" value="TM">{% trans %}TM{% endtrans %}
		<input type="radio" name="credit_type" value="EC">{% trans %}EC{% endtrans %}
		<input type="radio" name="credit_type" value="QC">{% trans %}QC{% endtrans %}
		<input type="radio" name="credit_type" value="TM">{% trans %}TM{% endtrans %}

		<input type="checkbox" name="semester" value="AUTUMN">A
		<input type="checkbox" name="semester" value="SPRING">P
		<input type="checkbox" name="semester" value="AUTUMN_AND_SPRING">
	</p>
</form>
{% if can_create_uv(user) %}
<p>
	<a href="{{ url('pedagogy:uv_create') }}">{% trans %}Create UV{% endtrans %}</a>
</p>
<br>
{% endif %}
<table>
	<thead>
		<tr>
			<td>{% trans %}UV{% endtrans %}</td>
			<td>{% trans %}Title{% endtrans %}</td>
			<td>{% trans %}Department{% endtrans %}</td>
			<td>{% trans %}Credit type{% endtrans %}</td>
			{% if can_create_uv(user) %}
			<td>{% trans %}Edit{% endtrans %}</td>
			<td>{% trans %}Delete{% endtrans %}</td>
			{% endif %}
		</tr>
	</thead>
	<tbody>
		{% for uv in object_list %}
		<tr>
			<td><a href="{{ url('pedagogy:uv_detail', uv_id=uv.id) }}">{{ uv.code }}</a></td>
			<td>{{ uv.title }}</td>
			<td>{{ uv.department }}</td>
			<td>{{ uv.credit_type }}</td>
			{% if user.is_owner(uv) -%}
			<td><a href="{{ url('pedagogy:uv_update', uv_id=uv.id) }}">{% trans %}Edit{% endtrans %}</a></td>
			<td><a href="{{ url('pedagogy:uv_delete', uv_id=uv.id) }}">{% trans %}Delete{% endtrans %}</a></td>
			{%- endif -%}
		</tr>
		{% endfor %}
	</tbody>
</table>

<script>

	// Auto fill from get arguments
	var urlParams = new URLSearchParams(window.location.search);
	function autofillCheckboxRadio(name){
		if (urlParams.has(name)){ $("input[name='" + name + "']").each(function(){
			if ($(this).attr("value") == urlParams.get(name))
				$(this).prop("checked", true);
		});
	}
}
if (urlParams.has("search"))
	$("input[name='search']").first().prop("value", urlParams.get("search"));
autofillCheckboxRadio("department");
autofillCheckboxRadio("credit_type");
autofillCheckboxRadio("semester");

	// Allow unchecking a radio button when we click on it
	// Keep a state of what is checked
	var formStates = {};
	function radioCheckToggle(e){
		if (formStates[this.name] == this.value){
			this.checked = false;
			formStates[this.name] = "";
			return;
		}
		formStates[this.name] = this.value;
	}

	$("input[type='radio']").each(function() {
		$(this).on("click", radioCheckToggle);
    	// Get current state
    	if ($(this).prop("checked")){
    		formStates[$(this).attr("name")] = $(this).attr("value");
    	}
    });

	var autumn_and_spring = $("input[value='AUTUMN_AND_SPRING']").first();
	var autumn = $("input[value='AUTUMN']").first();
	var spring = $("input[value='SPRING']").first();

    // Make autumn and spring hidden if js is enabled
    autumn_and_spring.hide();

    // Set correctly state of what is checked
    if (autumn_and_spring.prop("checked")){
    	autumn.prop("checked", true);
    	spring.prop("checked", true);
    	autumn_and_spring.prop("checked", false);
    }

    // Handle submit here and modify autumn and spring here
    $("#search_form").submit(function(e) {
    	e.preventDefault();
    	if (autumn.prop("checked") && spring.prop("checked")){
    		autumn_and_spring.prop("checked", true);
    		autumn.prop("checked", false);
    		spring.prop("checked", false);
    	}
    	this.submit();
    });
</script>
{% endblock content %}