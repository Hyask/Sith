{% extends "core/base.jinja" %}

{% block title %}
{{object.title}}
{% endblock %}

{% block head %}
{{ super() -}}
<style type="text/css">
  time {
    font-weight: bolder;
  }
</style>
{%- endblock %}

{% block content %}
	<h3>{{ object.title }}</h3>
	<hr>
	<section>
    <p>
      {% trans %}Polls close {% endtrans %} 
      <time datetime="{{ election.end_date }}">{{ election.end_date|date("l d F Y") }}</time> at <time>{{ election.end_date|time("G:i") }}</time>
    </p>
	</section>
	<section>
		<table>
			{%- set election_lists = object.election_list.all() -%}
			<caption></caption>
			<thead>
				{%- for election_list in election_lists %}
				<th>{{election_list.title}}</th>
				{%- endfor %}
			</thead>
			{%- for role in object.role.all() %}
			<tbody>
				<tr><td colspan="{{election_lists.count()}}">{{role.title}}</td></tr>
				<tr>
					{%- for election_list in election_lists %}
					<td>
						<ul>
						{%- for candidature in election_list.candidature.filter(role=role) %}
							<li>
								<figure>
									{%- if candidature.user.profile_pict %}
										<img src="{{candidature.user.profile_pict.get_download_url()}}" alt="{% trans %}Profile{% endtrans %}">
									{%- endif %}
									<figcaption>
										<cite>{{ candidature.user.first_name }} <em>{{candidature.user.nick_name or ''}} </em>{{ candidature.user.last_name }}</cite>
										<q>{{ candidature.program or '' }}</q>
									</figcaption>
								</figure>
							</li>
						{%- endfor %}
						</ul>
					</td>
					{%- endfor %}
				</tr>
			</tbody>
			{%- endfor %}
		</table>
	</section>

	{% if object.has_voted(request.user) %}
		A vot√©
	{% endif %}
	<h1>{{object.title}}</h1>
	<p>{{object.description}}</p>
	<p>{% trans %}End :{% endtrans %} {{object.end_date}}</p>
	{% if object.election_list.exists() %}
	<table>
		<tr>
		{% set nb_list = object.election_list.all().count() + 1 -%}
		{% for liste in object.election_list.all() %}
			<td>{{liste.title}}</td>
			{% if object.is_candidature_active -%}
			{% set nb_list = nb_list -%}
			{% else -%}
			{% set nb_list = nb_list + 1 -%}
			{% endif -%}
		{% endfor %}
		{% if not object.is_candidature_active -%}
		<td>{% trans %}Blank vote{% endtrans %}</td>
		{% endif %}
		</tr>
	{% for role in object.role.all() %}
		<tr><td colspan={{nb_list}}>{{role.title}}</td></tr>
		<tr>
			{% for liste in object.election_list.all() %}
			<td>
				<ul>
				{% for candidature in role.candidature.filter(election_list=liste) %}
				<li>
					{{candidature.user.first_name}} {{candidature.user.last_name}} {{candidature.user.nick_name or ''}}
					{% if candidature.user.profile_pict %}
					<br>
						<img src="{{candidature.user.profile_pict.get_download_url()}}" alt="{% trans %}Profile{% endtrans %}">
					{% endif %}
					<br>
					{{candidature.program or ''}}
				</li>
				{% endfor %}
				</ul>
			</td>
			{% endfor %}
			{% if not object.is_candidature_active -%}
			<td></td>
			{% endif %}
		</tr>
	{% endfor %}
	</table>
	{% endif %}
	<form action="{{url('election:candidate', election_id=object.id)}}" method="post">{{candidate_form}}
	{% csrf_token %}
	</form>
	{% if object.is_candidature_active -%}
		candidature
	{% endif -%}
{% endblock %}